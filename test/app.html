<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

	<title>Save Time app</title>

	<style type="text/css">
		* {
			margin: 0;
			padding: 0;
			border: none;
		}
		._canvas {
			position: relative;
			display: flex;
			width: 540px;
			height: 960px;
			background-color: #eee;
		}
	</style>

</head>
<body>
	<div class="conteiner">
		<div class="_canvas">
			<div id="">
				<div>sjj sjjnsjs</div>
			</div>
		</div>
		<button class="_save_image" onclick="saveImage()">
			Exportar
		</button>
	</div>
	
	<footer>
		<script type="text/javascript">

			//REQUEST
			function saveImage(){
				const instance = axios.create({
					baseURL: 'https://api.apiflash.com/v1'
				})

				instance.get('/urltoimage?access_key=ef0249bdde07485695646bb16f231f4c', {
					responseType: 'blob',
					params: {
						url: 'https://univida-savetime.herokuapp.com/',
						fresh: 'true',
						element: '._canvas',
						format: 'png',
						response_type: 'json'
					}
				})
				.then((response)=>{
					console.log(response.data);
					const url = window.URL.createObjectURL(new Blob([response.data]));
					const link = document.createElement('a');
					link.href = url;
					link.setAttribute("download", "testeimg.png");
					document.body.appendChild(link);
					link.click();
				})

				// console.log(`${urlReqBase}?${params.access_key}&${params.url}&${params.fresh}&${params.element}`)

				// xhttp.onreadystatechange = function(){//Função a ser chamada quando a requisição retornar do servidor
				//     if ( xhttp.readyState == 4 && xhttp.status == 200 ) {//Verifica se o retorno do servidor deu certo
				//         console.log(xhttp);
				//         // window.location.href=xhttp.responseURL;

				// 		const url = xhttp.response.url;
				// 		// window.URL.revokeObjectURL(url);
				// 		// a.remove();
				//     } else {
				// 		const url = 'https://api.apiflash.com/v1/urltoimage/cache/o1eo6lqz8w.png?access_key=73ce53a343d24b79a531f26028dcefda';
                // 		const baixar = document.createElement('a');
				// 		baixar.href = url;
				// 		baixar.download = "imagem";
				// 		baixar.click();
				// 	}
				// }

				// xhttp.send()
				
			}

		</script>
	</footer>

</body>
</html>