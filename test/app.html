<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Save Time app</title>
	<style type="text/css">
		* {
			margin: 0;
			padding: 0;
			border: none;
		}
		._canvas {
			position: relative;
			display: flex;
			width: 540px;
			height: 960px;
			background-color: #eee;
		}
	</style>
</head>
<body>
	<div class="conteiner">
		<div class="_canvas">
			<div id="">
				<div>sjj sjjnsjs</div>
			</div>
		</div>
		<button class="_save_image" onclick="saveImage()">
			Exportar
		</button>
	</div>
	
	<footer>
		<script type="text/javascript">

			function saveImage(){

				//REQUEST
				const urlReqBase = 'https://api.apiflash.com/v1/urltoimage';
				const params = {
					access_key: 'access_key=73ce53a343d24b79a531f26028dcefda',
					url: 'url=https://univida-savetime.herokuapp.com/',
					fresh: 'fresh=true',
					element: 'element=._canvas',
					format: 'format=png',
					response_type: 'response_type=image'
				}

				// console.log(`${urlReqBase}?${params.access_key}&${params.url}&${params.fresh}&${params.element}`)

				const xhttp = new XMLHttpRequest();
				const response = xhttp.open("GET", `
					${urlReqBase}?
					${params.access_key}&
					${params.url}&
					${params.fresh}&
					${params.element}&
					${params.format}&
					${params.response_type}`,
					false
				);

				console.log('response', response);

				xhttp.onreadystatechange = function(){//Função a ser chamada quando a requisição retornar do servidor
				    if ( xhttp.readyState == 4 && xhttp.status == 200 ) {//Verifica se o retorno do servidor deu certo
				        console.log(xhttp);
				        // window.location.href=xhttp.responseURL;

						var url = window.URL.createObjectURL(xhttp.responseURL);
                		var a = document.createElement('a');
                		document.body.appendChild(a);
						a.setAttribute('style', 'display: none');
						a.href = url;
						a.download = "produtos.png";
						a.click();
						window.URL.revokeObjectURL(url);
						a.remove();
				    }
				}

				xhttp.send()
				
			}

		</script>
	</footer>

</body>
</html>